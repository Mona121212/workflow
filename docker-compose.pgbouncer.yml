version: "3.8"
services:
  pgbouncer:
    image: edoburu/pgbouncer:latest
    container_name: pgbouncer
    restart: unless-stopped
    ports:
      - "6432:6432"
    environment:
      # Point PgBouncer at your Postgres
      # change host/user/password/db to your real values
      DB_HOST: host.docker.internal
      DB_PORT: "5432"
      DB_USER: postgres
      DB_PASSWORD: your_postgres_password
      DB_NAME: teamflow

      # PgBouncer core settings
      POOL_MODE: transaction         # critical for Prisma
      MAX_CLIENT_CONN: "1000"
      DEFAULT_POOL_SIZE: "50"
      MIN_POOL_SIZE: "5"
      RESERVE_POOL_SIZE: "10"
      SERVER_IDLE_TIMEOUT: "300"
      SERVER_RESET_QUERY: "DISCARD ALL"

      # Logging (optional but useful)
      LOG_CONNECTIONS: "1"
      LOG_DISCONNECTIONS: "1"
      STATS_PERIOD: "60"
    # Optionally mount custom configs if you need more control:
    # volumes:
    #   - ./pgbouncer/pgbouncer.ini:/etc/pgbouncer/pgbouncer.ini:ro
    #   - ./pgbouncer/users.txt:/etc/pgbouncer/users.txt:ro
